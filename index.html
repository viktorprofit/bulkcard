<script>
async function renderCard(ctx, W, H, data){
  const T = {
    ink:getVar('--ink'), ink2:getVar('--ink-2'),
    text:getVar('--text'), muted:getVar('--muted'),
    foil1:getVar('--foil-1'), foil2:getVar('--foil-2'), foil3:getVar('--foil-3')
  };

  // ---- layout constants (px) ----
  const OUT_R = 34;           // outer radius (foil)
  const IN_R  = 26;           // inner radius
  const P     = 36;           // inner padding
  const COL_L = Math.round((W - 2*P) * 0.42); // left column width
  const GAP   = 28;           // gap between columns
  const TITLE_H = 48;         // title block height
  const FIELD_SP = 12;        // space between label and value
  const FIELD_GAP = 18;       // gap after divider

  // ---- foil border ----
  const foil=ctx.createLinearGradient(0,0,W,H);
  foil.addColorStop(0,T.foil1); foil.addColorStop(.5,T.foil2); foil.addColorStop(1,T.foil3);
  ctx.fillStyle=foil; rr(ctx,0,0,W,H,OUT_R,true);

  // ---- inner bg ----
  const innerX=12, innerY=12, innerW=W-24, innerH=H-24;
  ctx.save(); ctx.translate(innerX,innerY);
  const bg=ctx.createLinearGradient(0,0,0,innerH);
  bg.addColorStop(0,T.ink); bg.addColorStop(1,T.ink2);
  ctx.fillStyle=bg; rr(ctx,0,0,innerW,innerH,IN_R,true);

  // vignettes
  const g1=ctx.createRadialGradient(0,0,0,0,0,innerW*1.1);
  g1.addColorStop(0,'rgba(115,106,108,.14)'); g1.addColorStop(1,'transparent');
  ctx.fillStyle=g1; rr(ctx,0,0,innerW,innerH,IN_R,true);
  const g2=ctx.createRadialGradient(innerW,innerH,0,innerW,innerH,innerW*1.1);
  g2.addColorStop(0,'rgba(90,44,64,.18)'); g2.addColorStop(1,'transparent');
  ctx.fillStyle=g2; rr(ctx,0,0,innerW,innerH,IN_R,true);

  // ---- header (aligned) ----
  const headerY = P + 6;                // keep away from top
  ctx.fillStyle=T.text; ctx.font='700 36px Fraunces, serif';
  ctx.fillText('Bulk Identity', P+0.5, headerY+36);
  drawChip(ctx, innerW - P - 64, headerY, 56, 40);

  // ---- photo (left column) ----
  const photoTop = headerY + TITLE_H;   // place strictly under title
  const photoSize = Math.min(COL_L, innerH - P - photoTop - 96);
  const photoX = P + 0.5, photoY = photoTop + 0.5;

  ctx.fillStyle='rgba(237,236,227,.06)';
  rr(ctx, photoX-6, photoY-6, photoSize+12, photoSize+12, 18, true);
  ctx.strokeStyle='rgba(237,236,227,.16)'; ctx.lineWidth=1;
  rrS(ctx, photoX-6, photoY-6, photoSize+12, photoSize+12, 18);

  const img = await loadImage(data.imgSrc);
  rrP(ctx, photoX, photoY, photoSize, photoSize, 14);
  ctx.save(); ctx.clip(); ctx.drawImage(img, photoX, photoY, photoSize, photoSize); ctx.restore();

  // ---- right column ----
  const rx = P + COL_L + GAP;
  let y = photoY + 4;                   // baseline start
  const lineX1 = rx, lineX2 = innerW - P + 0.5;

  const drawField = (label, value, opt={})=>{
    // label
    ctx.fillStyle=T.muted;
    ctx.font='600 16px Inter, system-ui';
    ctx.fillText(label, rx+0.5, y);
    y += FIELD_SP;

    // value
    ctx.fillStyle=T.text;
    if(opt.fancy){ ctx.font='700 44px Fraunces, serif'; }
    else if(opt.big){ ctx.font='700 24px Inter, system-ui'; }
    else { ctx.font='700 18px Inter, system-ui'; }
    ctx.fillText(value, rx+0.5, y);
    y += (opt.fancy? 40 : opt.big? 28 : 22);

    // divider
    ctx.strokeStyle='rgba(237,236,227,.14)';
    ctx.lineWidth=1;
    ctx.beginPath();
    ctx.moveTo(lineX1+0.5, y+8.5);
    ctx.lineTo(lineX2,   y+8.5);
    ctx.stroke();
    y += FIELD_GAP + 12;
  };

  drawField('Name',       data.name || 'Real Bulkoor', {fancy:true});
  drawField('Discord',    formatDiscord(data.discord), {big:true});
  drawField('Bullish',    data.bullish, {big:true});
  drawField('Member ID',  window.memberId, {big:true});
  drawField('Valid Thru', '∞', {big:true});

  // ---- footer (under left+right columns) ----
  const footerY = photoY + photoSize + 36.5;
  ctx.strokeStyle='rgba(237,236,227,.14)'; ctx.lineWidth=1;
  ctx.beginPath(); ctx.moveTo(P+0.5, footerY); ctx.lineTo(innerW-P+0.5, footerY); ctx.stroke();

  ctx.fillStyle=T.muted; ctx.font='400 18px Inter, system-ui';
  ctx.fillText('Issued by Bulk Identity Authority · Non-transferable · For community use', P+0.5, footerY+30);

  // ---- seal (kept inside safe area) ----
  const sealR = 110;
  drawSeal(ctx, innerW - P - sealR, innerH - P - 12 - sealR, sealR);

  ctx.restore(); // end inner
}
</script>
